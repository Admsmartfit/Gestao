# Product Requirements Document (PRD)
## Sistema GMM - Gest√£o de Manuten√ß√£o de Academias

**Vers√£o:** 2.0  
**Data:** Dezembro 2024  
**Autor:** Equipe de Produto  
**Status:** Em Desenvolvimento

---

## 1. Vis√£o Geral do Produto

### 1.1 Objetivo
Sistema web integrado para gest√£o completa de manuten√ß√£o predial e de equipamentos em rede de academias, incluindo controle de ponto geolocalizado, gest√£o inteligente de estoque e comunica√ß√£o automatizada com prestadores de servi√ßo.

### 1.2 Problema a Resolver
- Falta de rastreabilidade em manuten√ß√µes realizadas
- Controle manual e impreciso de estoque de pe√ßas
- Dificuldade em gerenciar prazos de terceirizados
- Aus√™ncia de controle de ponto vinculado √† localiza√ß√£o f√≠sica
- Comunica√ß√£o fragmentada entre t√©cnicos, gerentes e fornecedores

### 1.3 P√∫blico-Alvo
- **T√©cnicos de Manuten√ß√£o:** Registro de servi√ßos e consumo de materiais
- **Gerentes de Opera√ß√µes:** Monitoramento, aprova√ß√µes e an√°lise de indicadores
- **Administradores:** Configura√ß√£o do sistema e gest√£o de usu√°rios

### 1.4 M√©tricas de Sucesso (KPIs)
- Redu√ß√£o de 40% no tempo de registro de manuten√ß√µes
- 100% de rastreabilidade de pe√ßas utilizadas
- Redu√ß√£o de 30% em atrasos de terceirizados
- Taxa de ado√ß√£o de 90% pelos t√©cnicos em 3 meses

---

## 2. Stack Tecnol√≥gica

### 2.1 Backend
- **Framework:** Flask 3.0+ (Python 3.11+)
- **ORM:** SQLAlchemy 2.0
- **Autentica√ß√£o:** Flask-Login + werkzeug.security
- **Valida√ß√£o:** Flask-WTF + Marshmallow
- **Task Queue:** Celery (para notifica√ß√µes ass√≠ncronas)

### 2.2 Database
- **Desenvolvimento:** SQLite 3
- **Produ√ß√£o:** PostgreSQL 15+ (migra√ß√£o planejada Fase 2)
- **Migrations:** Flask-Migrate (Alembic)

### 2.3 Frontend
- **HTML5 + CSS3**
- **Framework CSS:** Bootstrap 5.3 (CDN)
- **JavaScript:** Vanilla JS + Fetch API
- **Upload de Imagens:** Dropzone.js
- **Gr√°ficos:** Chart.js (dashboard)

### 2.4 Integra√ß√µes
- **WhatsApp:** MegaAPI (API REST)
- **Armazenamento:** Sistema de arquivos local (Fase 1) ‚Üí AWS S3 (Fase 2)

### 2.5 Infraestrutura
- **Web Server:** Gunicorn + Nginx
- **Ambiente:** Docker + Docker Compose
- **Deploy:** AWS EC2 / DigitalOcean Droplet

---

## 3. Arquitetura de M√≥dulos

### üì¶ M√≥dulo 1: Autentica√ß√£o e Controle de Acesso

#### 3.1.1 Modelo de Dados

```sql
-- Tabela: unidades
CREATE TABLE unidades (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    nome VARCHAR(100) NOT NULL UNIQUE,
    endereco TEXT,
    faixa_ip_permitida VARCHAR(20) NOT NULL, -- Ex: "192.168.1"
    ssid_wifi VARCHAR(50), -- Nome da rede Wi-Fi
    criado_em TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    ativo BOOLEAN DEFAULT TRUE
);

-- Tabela: usuarios
CREATE TABLE usuarios (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    nome VARCHAR(150) NOT NULL,
    email VARCHAR(150) UNIQUE NOT NULL,
    login VARCHAR(50) UNIQUE NOT NULL,
    senha_hash VARCHAR(255) NOT NULL,
    tipo ENUM('tecnico', 'gerente', 'admin') NOT NULL,
    unidade_id INTEGER,
    foto_perfil VARCHAR(255),
    ativo BOOLEAN DEFAULT TRUE,
    criado_em TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (unidade_id) REFERENCES unidades(id)
);

-- Tabela: registros_ponto
CREATE TABLE registros_ponto (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    usuario_id INTEGER NOT NULL,
    unidade_id INTEGER NOT NULL,
    tipo ENUM('entrada', 'saida') NOT NULL,
    data_hora TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    ip_origem VARCHAR(45) NOT NULL, -- Suporta IPv6
    latitude DECIMAL(10, 8),
    longitude DECIMAL(11, 8),
    observacao TEXT,
    FOREIGN KEY (usuario_id) REFERENCES usuarios(id),
    FOREIGN KEY (unidade_id) REFERENCES unidades(id)
);
```

#### 3.1.2 Regras de Neg√≥cio

**RN001 - Valida√ß√£o de IP:**
- O sistema deve verificar se o IP do request (`request.remote_addr`) corresponde √† faixa permitida da unidade
- Se n√£o corresponder: Bloquear a√ß√£o e retornar HTTP 403 com mensagem espec√≠fica
- Implementar via decorator `@require_unit_ip`

**RN002 - Controle de Ponto:**
- Permitir apenas 1 entrada sem sa√≠da correspondente
- Calcular automaticamente horas trabalhadas ao registrar sa√≠da
- Alertar se intervalo entre entrada/sa√≠da < 2 horas (poss√≠vel erro)

**RN003 - Seguran√ßa de Senha:**
- Hash: bcrypt com cost factor 12
- Pol√≠tica: M√≠nimo 8 caracteres, 1 mai√∫scula, 1 n√∫mero
- Expira√ß√£o: 90 dias (apenas para gerentes/admins)

#### 3.1.3 Endpoints da API

| M√©todo | Endpoint | Descri√ß√£o | Auth |
|--------|----------|-----------|------|
| POST | `/api/auth/login` | Autentica√ß√£o de usu√°rio | N√£o |
| POST | `/api/auth/logout` | Encerrar sess√£o | Sim |
| POST | `/api/ponto/checkin` | Registrar entrada | Sim |
| POST | `/api/ponto/checkout` | Registrar sa√≠da | Sim |
| GET | `/api/ponto/historico` | Hist√≥rico de pontos | Sim |

#### 3.1.4 Crit√©rios de Aceite

- [ ] CA001: Usu√°rio n√£o pode fazer check-in fora da rede Wi-Fi da unidade
- [ ] CA002: Sistema exibe mensagem clara de erro ao tentar check-in com IP inv√°lido
- [ ] CA003: Hist√≥rico de ponto exibe data, hora, unidade e dura√ß√£o calculada
- [ ] CA004: Logout limpa sess√£o e redireciona para login

#### 3.1.5 Prompt para Desenvolvimento

```
Atue como Engenheiro de Software S√™nior Full-Stack.

CONTEXTO:
Estamos construindo o M√≥dulo 1 (Autentica√ß√£o e Controle de Ponto) do Sistema GMM.

TAREFA:
1. Crie uma aplica√ß√£o Flask com estrutura modular (blueprints)
2. Configure SQLAlchemy com as tabelas: unidades, usuarios, registros_ponto
3. Implemente:
   - Sistema de autentica√ß√£o com Flask-Login
   - Decorator @require_unit_ip que valida IP antes de check-in/out
   - Rotas: /login, /logout, /ponto/checkin, /ponto/checkout
   - Hash de senhas com bcrypt
4. Crie templates HTML com Bootstrap 5:
   - login.html (formul√°rio responsivo)
   - dashboard.html (p√°gina inicial p√≥s-login)
   - ponto.html (bot√µes de entrada/sa√≠da)

REQUISITOS T√âCNICOS:
- Use Flask-WTF para formul√°rios com CSRF protection
- Mensagens flash para feedback ao usu√°rio
- Valida√ß√£o: IP deve come√ßar com unidade.faixa_ip_permitida
- Se IP inv√°lido: retornar JSON {"error": "Acesso negado: conecte-se ao Wi-Fi da unidade"} com status 403

ENTREGA:
- C√≥digo fonte organizado em m√≥dulos
- requirements.txt
- README com instru√ß√µes de setup
- SQL para popular dados de teste
```

---

### üì¶ M√≥dulo 2: Gest√£o de Manuten√ß√£o e Estoque

#### 3.2.1 Modelo de Dados

```sql
-- Tabela: categorias_equipamento
CREATE TABLE categorias_equipamento (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    nome VARCHAR(100) NOT NULL UNIQUE,
    descricao TEXT
);

-- Tabela: equipamentos
CREATE TABLE equipamentos (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    codigo VARCHAR(50) UNIQUE NOT NULL,
    nome VARCHAR(150) NOT NULL,
    categoria_id INTEGER,
    unidade_id INTEGER NOT NULL,
    fabricante VARCHAR(100),
    modelo VARCHAR(100),
    numero_serie VARCHAR(100),
    data_aquisicao DATE,
    data_ultima_manutencao DATE,
    status ENUM('operacional', 'manutencao', 'inativo') DEFAULT 'operacional',
    FOREIGN KEY (categoria_id) REFERENCES categorias_equipamento(id),
    FOREIGN KEY (unidade_id) REFERENCES unidades(id)
);

-- Tabela: estoque
CREATE TABLE estoque (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    codigo VARCHAR(50) UNIQUE NOT NULL,
    nome_peca VARCHAR(200) NOT NULL,
    descricao TEXT,
    unidade_medida ENUM('UN', 'METROS', 'KG', 'LITROS') NOT NULL,
    quantidade DECIMAL(10, 2) NOT NULL DEFAULT 0,
    quantidade_minima DECIMAL(10, 2) NOT NULL DEFAULT 0,
    preco_unitario DECIMAL(10, 2),
    localizacao VARCHAR(100), -- Ex: "Arm√°rio 3 - Prateleira B"
    ultima_atualizacao TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CHECK (quantidade >= 0)
);

-- Tabela: ordens_servico
CREATE TABLE ordens_servico (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    numero_os VARCHAR(20) UNIQUE NOT NULL, -- Auto-gerado: OS-2024-0001
    tecnico_id INTEGER NOT NULL,
    unidade_id INTEGER NOT NULL,
    equipamento_id INTEGER,
    tipo_manutencao ENUM('preventiva', 'corretiva', 'preditiva') NOT NULL,
    prioridade ENUM('baixa', 'media', 'alta', 'urgente') DEFAULT 'media',
    titulo VARCHAR(200) NOT NULL,
    descricao_problema TEXT NOT NULL,
    solucao_aplicada TEXT,
    tempo_execucao INTEGER, -- Minutos
    status ENUM('aberta', 'em_andamento', 'aguardando_peca', 'concluida', 'cancelada') DEFAULT 'aberta',
    data_abertura TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    data_conclusao TIMESTAMP,
    avaliacao INTEGER CHECK (avaliacao BETWEEN 1 AND 5),
    observacoes TEXT,
    FOREIGN KEY (tecnico_id) REFERENCES usuarios(id),
    FOREIGN KEY (unidade_id) REFERENCES unidades(id),
    FOREIGN KEY (equipamento_id) REFERENCES equipamentos(id)
);

-- Tabela: anexos_os
CREATE TABLE anexos_os (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    os_id INTEGER NOT NULL,
    tipo ENUM('foto_antes', 'foto_depois', 'documento', 'video') NOT NULL,
    nome_arquivo VARCHAR(255) NOT NULL,
    caminho_arquivo VARCHAR(500) NOT NULL,
    tamanho_kb INTEGER,
    upload_em TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (os_id) REFERENCES ordens_servico(id) ON DELETE CASCADE
);

-- Tabela: movimentacao_estoque
CREATE TABLE movimentacao_estoque (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    estoque_id INTEGER NOT NULL,
    os_id INTEGER, -- NULL se for entrada de compra
    tipo ENUM('entrada', 'saida', 'ajuste', 'devolucao') NOT NULL,
    quantidade DECIMAL(10, 2) NOT NULL,
    quantidade_anterior DECIMAL(10, 2) NOT NULL,
    quantidade_nova DECIMAL(10, 2) NOT NULL,
    motivo TEXT,
    usuario_id INTEGER NOT NULL,
    data_movimentacao TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (estoque_id) REFERENCES estoque(id),
    FOREIGN KEY (os_id) REFERENCES ordens_servico(id),
    FOREIGN KEY (usuario_id) REFERENCES usuarios(id)
);
```

#### 3.2.2 Regras de Neg√≥cio

**RN004 - Controle de Estoque:**
- Ao usar pe√ßa em OS: Criar movimenta√ß√£o tipo "saida" e decrementar estoque
- Se `estoque.quantidade < movimentacao.quantidade`: Bloquear com erro "Estoque insuficiente"
- Se `estoque.quantidade < estoque.quantidade_minima`: Enviar alerta ao gerente

**RN005 - Numera√ß√£o de OS:**
- Formato: `OS-{ANO}-{SEQUENCIAL}` (ex: OS-2024-0001)
- Sequencial reinicia a cada ano
- Fun√ß√£o auto-incremento no backend

**RN006 - Upload de Fotos:**
- Formatos aceitos: JPG, PNG, HEIC
- Tamanho m√°ximo: 5MB por arquivo
- M√°ximo 10 fotos por OS
- Armazenamento: `/static/uploads/os/{os_id}/`
- Compress√£o autom√°tica para thumbnails (300x300px)

**RN007 - Valida√ß√£o de Consumo:**
- Pe√ßas medidas em METROS: Aceitar decimais (ex: 3.5m)
- Validar quantidade > 0
- Impedir uso de pe√ßas em OS com status "cancelada"

#### 3.2.3 Endpoints da API

| M√©todo | Endpoint | Descri√ß√£o | Auth |
|--------|----------|-----------|------|
| POST | `/api/os/criar` | Criar nova OS | T√©cnico+ |
| PUT | `/api/os/{id}` | Atualizar OS | T√©cnico+ |
| POST | `/api/os/{id}/anexos` | Upload de fotos | T√©cnico+ |
| POST | `/api/os/{id}/usar-peca` | Consumir pe√ßa do estoque | T√©cnico+ |
| GET | `/api/estoque` | Listar itens de estoque | T√©cnico+ |
| GET | `/api/estoque/alertas` | Itens abaixo do m√≠nimo | Gerente+ |
| POST | `/api/estoque/entrada` | Registrar entrada de pe√ßas | Gerente+ |

#### 3.2.4 Crit√©rios de Aceite

- [ ] CA005: Sistema impede uso de pe√ßa com estoque insuficiente
- [ ] CA006: N√∫mero de OS √© gerado automaticamente no formato correto
- [ ] CA007: Upload de m√∫ltiplas fotos funciona (at√© 10 arquivos)
- [ ] CA008: Thumbnails s√£o gerados automaticamente
- [ ] CA009: Movimenta√ß√£o de estoque registra saldo anterior e novo
- [ ] CA010: Dashboard exibe alertas para itens com estoque abaixo do m√≠nimo
- [ ] CA011: Campos decimais aceitam v√≠rgula e ponto como separador

#### 3.2.5 Prompt para Desenvolvimento

```
Atue como Engenheiro de Software S√™nior Full-Stack.

CONTEXTO:
M√≥dulo 2 do Sistema GMM - Gest√£o de Manuten√ß√£o e Estoque.

TAREFA:
1. Adicione as tabelas: equipamentos, estoque, ordens_servico, anexos_os, movimentacao_estoque
2. Implemente a l√≥gica de numera√ß√£o autom√°tica de OS (formato OS-YYYY-9999)
3. Crie rotas:
   - POST /api/os/criar (criar OS e vincular t√©cnico/unidade)
   - POST /api/os/{id}/usar-peca (validar estoque antes de descontar)
   - POST /api/os/{id}/anexos (upload m√∫ltiplo com valida√ß√£o)
4. Funcionalidades:
   - Upload de imagens com Pillow (compress√£o para web)
   - Valida√ß√£o: bloquear se quantidade_solicitada > estoque.quantidade
   - Gerar thumbnail 300x300 para cada foto
   - Salvar caminho relativo no banco
5. Templates HTML:
   - nova_os.html (formul√°rio com sele√ß√£o de equipamento, dropzone para fotos)
   - detalhes_os.html (visualiza√ß√£o com galeria de fotos, hist√≥rico de pe√ßas)
   - estoque.html (tabela com filtros, indicador visual para itens cr√≠ticos)

REQUISITOS T√âCNICOS:
- Use SQLAlchemy relationships (backref) para facilitar queries
- Transa√ß√µes at√¥micas: se falhar upload de foto, reverter cria√ß√£o da OS
- Aceitar decimal com v√≠rgula no frontend, converter para ponto no backend
- Implementar soft delete para OS (status "cancelada" em vez de DELETE)

REGRA CR√çTICA:
Ao usar pe√ßa: 
1. Verificar estoque.quantidade >= quantidade_solicitada
2. Se OK: INSERT em movimentacao_estoque + UPDATE estoque.quantidade
3. Se estoque < minimo: adicionar flag para gerar alerta

ENTREGA:
- C√≥digo com tratamento de exce√ß√µes
- Valida√ß√£o de tipos de arquivo (magic numbers, n√£o apenas extens√£o)
- Logs de auditoria para movimenta√ß√µes
```

---

### üì¶ M√≥dulo 3: Gest√£o de Terceirizados e Notifica√ß√µes

#### 3.3.1 Modelo de Dados

```sql
-- Tabela: terceirizados
CREATE TABLE terceirizados (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    nome VARCHAR(150) NOT NULL,
    nome_empresa VARCHAR(150),
    cnpj VARCHAR(18),
    telefone VARCHAR(20) NOT NULL, -- Formato: 5511999999999
    email VARCHAR(150),
    especialidades TEXT, -- JSON array: ["Eletrica", "Hidraulica"]
    avaliacao_media DECIMAL(3, 2), -- 0.00 a 5.00
    total_servicos INTEGER DEFAULT 0,
    ativo BOOLEAN DEFAULT TRUE,
    observacoes TEXT,
    criado_em TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Tabela: chamados_externos
CREATE TABLE chamados_externos (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    numero_chamado VARCHAR(20) UNIQUE NOT NULL, -- CH-2024-0001
    os_id INTEGER, -- Pode ser NULL se chamado independente
    terceirizado_id INTEGER NOT NULL,
    titulo VARCHAR(200) NOT NULL,
    descricao TEXT NOT NULL,
    prioridade ENUM('baixa', 'media', 'alta', 'urgente') DEFAULT 'media',
    status ENUM('aguardando', 'aceito', 'em_andamento', 'concluido', 'cancelado') DEFAULT 'aguardando',
    prazo_combinado TIMESTAMP NOT NULL,
    data_inicio TIMESTAMP,
    data_conclusao TIMESTAMP,
    valor_orcado DECIMAL(10, 2),
    valor_final DECIMAL(10, 2),
    avaliacao INTEGER CHECK (avaliacao BETWEEN 1 AND 5),
    feedback TEXT,
    criado_por INTEGER NOT NULL,
    criado_em TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (os_id) REFERENCES ordens_servico(id),
    FOREIGN KEY (terceirizado_id) REFERENCES terceirizados(id),
    FOREIGN KEY (criado_por) REFERENCES usuarios(id)
);

-- Tabela: historico_notificacoes
CREATE TABLE historico_notificacoes (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    chamado_id INTEGER NOT NULL,
    tipo ENUM('criacao', 'lembrete', 'cobranca', 'conclusao') NOT NULL,
    destinatario VARCHAR(20) NOT NULL, -- Telefone
    mensagem TEXT NOT NULL,
    status_envio ENUM('pendente', 'enviado', 'falhou', 'entregue') DEFAULT 'pendente',
    resposta_api TEXT, -- JSON da resposta da MegaAPI
    tentativas INTEGER DEFAULT 0,
    enviado_em TIMESTAMP,
    entregue_em TIMESTAMP,
    FOREIGN KEY (chamado_id) REFERENCES chamados_externos(id)
);
```

#### 3.3.2 Integra√ß√£o com MegaAPI (WhatsApp)

**Especifica√ß√£o da API:**
```python
# Endpoint: https://api.megaapi.com.br/v1/messages/send
# M√©todo: POST
# Headers:
# - Content-Type: application/json
# - Authorization: Bearer {API_KEY}

# Payload:
{
    "phone": "5511999999999",  # Formato internacional
    "message": "Texto da mensagem",
    "media_url": "https://...",  # Opcional: link para imagem/documento
}

# Resposta de Sucesso (200):
{
    "success": true,
    "message_id": "msg_abc123",
    "status": "sent"
}

# Resposta de Erro (4xx/5xx):
{
    "success": false,
    "error": "Invalid phone number",
    "code": "INVALID_PHONE"
}
```

#### 3.3.3 Regras de Neg√≥cio

**RN008 - Notifica√ß√£o Autom√°tica:**
Ao criar chamado externo, enviar mensagem:
```
üîß *Novo Chamado GMM*

*Chamado:* CH-2024-0001
*T√≠tulo:* {titulo}
*Prioridade:* {prioridade}
*Prazo:* {prazo_combinado}
*Unidade:* {unidade.nome}

*Descri√ß√£o:*
{descricao}

Para aceitar, responda: SIM
```

**RN009 - Sistema de Lembretes:**
- 48h antes do prazo: Lembrete autom√°tico
- No prazo: Se status != "concluido", enviar cobran√ßa
- Implementar via Celery Beat (tarefas agendadas)

**RN010 - Retry Policy:**
- M√°ximo 3 tentativas em caso de falha
- Intervalo exponencial: 1min, 5min, 15min
- Ap√≥s 3 falhas: Alertar gerente e marcar como "falhou"

**RN011 - Avalia√ß√£o de Terceirizados:**
- Obrigat√≥ria ao concluir chamado
- Escala de 1 a 5 estrelas
- Calcular m√©dia automaticamente

#### 3.3.4 Endpoints da API

| M√©todo | Endpoint | Descri√ß√£o | Auth |
|--------|----------|-----------|------|
| POST | `/api/chamados/criar` | Criar chamado externo | T√©cnico+ |
| PUT | `/api/chamados/{id}` | Atualizar status | Gerente+ |
| POST | `/api/chamados/{id}/cobrar` | Reenviar notifica√ß√£o | Gerente+ |
| GET | `/api/terceirizados` | Listar prestadores | T√©cnico+ |
| POST | `/api/terceirizados` | Cadastrar prestador | Gerente+ |
| POST | `/api/chamados/{id}/avaliar` | Avaliar servi√ßo | Gerente+ |

#### 3.3.5 Crit√©rios de Aceite

- [ ] CA012: Notifica√ß√£o WhatsApp √© enviada ao criar chamado
- [ ] CA013: Sistema registra hist√≥rico de todas notifica√ß√µes
- [ ] CA014: Falha no envio n√£o impede cria√ß√£o do chamado
- [ ] CA015: Bot√£o "Cobrar" reenvia mensagem personalizada
- [ ] CA016: Dashboard exibe status de entrega das mensagens
- [ ] CA017: Avalia√ß√£o atualiza m√©dia do terceirizado automaticamente

#### 3.3.6 Prompt para Desenvolvimento

```
Atue como Engenheiro de Software S√™nior Full-Stack.

CONTEXTO:
M√≥dulo 3 do Sistema GMM - Gest√£o de Terceirizados e Notifica√ß√µes via WhatsApp.

TAREFA:
1. Crie as tabelas: terceirizados, chamados_externos, historico_notificacoes
2. Implemente fun√ß√£o enviar_whatsapp(telefone, mensagem):
   - Fazer POST para MegaAPI
   - Tratar timeout (5 segundos)
   - Salvar resposta em historico_notificacoes
   - Implementar retry com backoff exponencial
3. Criar Celery task para lembretes autom√°ticos:
   - Executar diariamente √†s 9h
   - Buscar chamados com prazo_combinado entre hoje e hoje+2
   - Enviar lembrete se status != "concluido"
4. Rotas:
   - POST /api/chamados/criar (criar + trigger notifica√ß√£o)
   - POST /api/chamados/{id}/cobrar (bot√£o de cobran√ßa)
   - GET /api/chamados/atrasados (filtrar por prazo vencido)
5. Templates:
   - chamados.html (lista com sem√°foro: verde=OK, amarelo=pr√≥ximo, vermelho=atrasado)
   - detalhes_chamado.html (timeline de notifica√ß√µes enviadas)

REQUISITOS T√âCNICOS:
- Configurar Celery com broker Redis
- Task ass√≠ncrona: n√£o bloquear response ao enviar WhatsApp
- Validar formato de telefone (regex: ^\d{13}$)
- Criptografar API_KEY no .env (n√£o commitar)
- Implementar circuit breaker: se API falhar 5x seguidas, pausar envios por 10min

MENSAGENS:
Template de cria√ß√£o (use f-string):
f"üîß Novo Chamado GMM\n\nChamado: {numero}\nPrazo: {prazo}\n\n{descricao}"

Template de cobran√ßa:
f"‚è∞ Prazo Vencido\n\nChamado: {numero}\nPrevis√£o de conclus√£o?"

ENTREGA:
- C√≥digo com tratamento robusto de erros HTTP
- Logs estruturados (JSON) para auditoria
- Testes unit√°rios para fun√ß√£o de envio
- Documenta√ß√£o da integra√ß√£o MegaAPI
```

---

### üì¶ M√≥dulo 4: Dashboard Gerencial e Analytics

#### 3.4.1 Modelo de Dados

```sql
-- Tabela: pedidos_compra
CREATE TABLE pedidos_compra (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    numero_pedido VARCHAR(20) UNIQUE NOT NULL,
    fornecedor VARCHAR(150) NOT NULL,
    contato_fornecedor VARCHAR(150),
    itens TEXT NOT NULL, -- JSON: [{"peca": "Cabo", "qtd": 50, "valor": 200}]
    valor_total DECIMAL(10, 2) NOT NULL,
    status ENUM('solicitado', 'aprovado', 'em_transito', 'entregue', 'cancelado') DEFAULT 'solicitado',
    data_pedido DATE NOT NULL,
    previsao_entrega DATE NOT NULL,
    data_entrega DATE,
    observacoes TEXT,
    solicitado_por INTEGER NOT NULL,
    aprovado_por INTEGER,
    criado_em TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (solicitado_por) REFERENCES usuarios(id),
    FOREIGN KEY (aprovado_por) REFERENCES usuarios(id)
);

-- Tabela: indicadores_performance (cache de m√©tricas)
CREATE TABLE indicadores_performance (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    data_referencia DATE NOT NULL,
    unidade_id INTEGER,
    total_os INTEGER DEFAULT 0,
    os_concluidas INTEGER DEFAULT 0,
    os_atrasadas INTEGER DEFAULT 0,
    tempo_medio_resolucao INTEGER, -- Minutos
    taxa_conclusao DECIMAL(5, 2), -- Percentual
    custo_total_pecas DECIMAL(10, 2),
    avaliacao_media DECIMAL(3, 2),
    atualizado_em TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (unidade_id) REFERENCES unidades(id)
);
```

#### 3.4.2 Regras de Neg√≥cio

**RN012 - Sem√°foro de Status:**
- **Verde:** Prazo OK e status "em_andamento" ou "aceito"
- **Amarelo:** Faltam 24h para o prazo e status != "concluido"
- **Vermelho:** Prazo vencido e status != "concluido"

**RN013 - C√°lculo de Indicadores:**
Executar daily via Celery:
1. Calcular para cada unidade:
   - Total de OS abertas vs conclu√≠das (taxa de conclus√£o)
   - Tempo m√©dio entre abertura e conclus√£o
   - Custo total em pe√ßas (somar movimentacoes * preco_unitario)
   - M√©dia de avalia√ß√µes
2. Salvar em `indicadores_performance`

**RN014 - Alertas Autom√°ticos:**
Condi√ß√µes para notificar gerente:
- Estoque abaixo do m√≠nimo (3+ itens)
- Chamado atrasado 2+ dias
- Taxa de conclus√£o < 70% no m√™s
- Pedido de compra com entrega atrasada

#### 3.4.3 Endpoints da API

| M√©todo | Endpoint | Descri√ß√£o | Auth |
|--------|----------|-----------|------|
| GET | `/api/dashboard/metricas` | KPIs consolidados | Gerente+ |
| GET | `/api/dashboard/chamados-status` | Status de chamados externos | Gerente+ |
| GET | `/api/dashboard/estoque-critico` | Itens abaixo do m√≠nimo | Gerente+ |
| GET | `/api/pedidos` | Listar pedidos de compra | Gerente+ |
| POST | `/api/pedidos` | Criar pedido | Gerente+ |
| GET | `/api/relatorios/os` | Relat√≥rio de OS (filtros) | Gerente+ |

#### 3.4.4 Layouts de Dashboard

**Vis√£o Geral (Cards):**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ OS Abertas  ‚îÇ Conclu√≠das  ‚îÇ Atrasadas   ‚îÇ Estoque OK  ‚îÇ
‚îÇ    15       ‚îÇ    142      ‚îÇ     3       ‚îÇ    87%      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Tabela de Chamados Externos:**
```
Chamado    | Terceirizado      | Prazo       | Status        | A√ß√£o
-----------|-------------------|-------------|---------------|-------
CH-2024-15 | El√©trica Silva    | 15/12 (OK)  | ‚óè Em andamento| [Ver]
CH-2024-14 | Hidr√°ulica JM     | 13/12 (!)   | ‚óè Atrasado   | [Cobrar]
CH-2024-13 | Climatiza√ß√£o Pro  | 20/12 (OK)  | ‚óè Aguardando | [Ver]
```

**Gr√°ficos:**
- Evolu√ß√£o de OS por m√™s (linha)
- Distribui√ß√£o por tipo de manuten√ß√£o (pizza)
- Top 5 pe√ßas mais utilizadas (barras)
- Taxa de conclus√£o por unidade (barras horizontais)

#### 3.4.5 Crit√©rios de Aceite

- [ ] CA018: Dashboard carrega em menos de 2 segundos
- [ ] CA019: Indicadores s√£o atualizados automaticamente √†s 6h diariamente
- [ ] CA020: Sem√°foro de chamados exibe cores corretas (verde/amarelo/vermelho)
- [ ] CA021: Bot√£o "Cobrar" s√≥ aparece para chamados atrasados
- [ ] CA022: Filtros de data funcionam em todos os relat√≥rios
- [ ] CA023: Gr√°ficos s√£o responsivos (adaptam a mobile)
- [ ] CA024: Exporta√ß√£o de relat√≥rios em CSV funciona
- [ ] CA025: Alertas s√£o enviados ao gerente via email/notifica√ß√£o

#### 3.4.6 Prompt para Desenvolvimento

```
Atue como Engenheiro de Software S√™nior Full-Stack.

CONTEXTO:
M√≥dulo 4 do Sistema GMM - Dashboard Gerencial e Analytics.

TAREFA:
1. Criar tabelas: pedidos_compra, indicadores_performance
2. Implementar rota /dashboard com:
   - 4 cards de m√©tricas (queries agregadas)
   - Tabela de chamados com sem√°foro de status
   - Tabela de estoque cr√≠tico (quantidade < quantidade_minima)
   - Tabela de pedidos com previs√£o de entrega
3. L√≥gica de sem√°foro:
   ```python
   def calcular_status_chamado(chamado):
       if chamado.status == 'concluido':
           return 'success'
       
       dias_restantes = (chamado.prazo_combinado - datetime.now()).days
       
       if dias_restantes < 0:
           return 'danger'  # Vermelho - Atrasado
       elif dias_restantes <= 1:
           return 'warning'  # Amarelo - Cr√≠tico
       else:
           return 'info'     # Verde - OK
   ```
4. Celery Task di√°ria (6h):
   ```python
   @celery.task
   def calcular_indicadores_diarios():
       for unidade in Unidade.query.all():
           # Calcular m√©tricas
           # Salvar em indicadores_performance
   ```
5. Implementar gr√°ficos com Chart.js:
   - Endpoint: GET /api/dashboard/graficos
   - Retornar JSON para cada gr√°fico
6. Sistema de alertas:
   - Verificar condi√ß√µes cr√≠ticas
   - Enviar email para gerente se necess√°rio
   - Registrar em tabela de notificacoes_sistema

REQUISITOS T√âCNICOS:
- Usar queries otimizadas (SELECT com agrega√ß√µes)
- Cache de indicadores (evitar recalcular a cada request)
- Pagina√ß√£o em tabelas (max 50 registros por p√°gina)
- Filtros via query params: ?unidade_id=1&data_inicio=2024-01-01
- Exporta√ß√£o CSV: bot√£o que gera arquivo com dados filtrados

LAYOUT HTML (Bootstrap 5):
- Grid responsivo: col-lg-3 para cards, col-lg-6 para gr√°ficos
- Tabelas com classes: table table-hover table-sm
- Badge para status: badge bg-success/warning/danger
- Bot√£o cobrar: btn btn-sm btn-outline-danger
- Icons: Bootstrap Icons via CDN

C√ÅLCULOS:
- Taxa conclus√£o: (concluidas / total) * 100
- Tempo m√©dio: AVG(data_conclusao - data_abertura) em minutos
- Custo total: SUM(movimentacao.quantidade * estoque.preco_unitario)

ENTREGA:
- Dashboard funcional com dados reais
- Gr√°ficos interativos (hover, tooltips)
- Sistema de alertas configur√°vel
- Documenta√ß√£o de queries SQL usadas
```

---

## 4. Fluxos de Trabalho (User Flows)

### 4.1 Fluxo do T√©cnico

```
1. LOGIN
   ‚îú‚îÄ Acessar sistema pelo navegador
   ‚îú‚îÄ Inserir credenciais
   ‚îî‚îÄ Valida√ß√£o de IP da rede Wi-Fi
       ‚îú‚îÄ ‚úì IP v√°lido ‚Üí Redirecionar para Dashboard
       ‚îî‚îÄ ‚úó IP inv√°lido ‚Üí Erro: "Conecte-se ao Wi-Fi da unidade"

2. CHECK-IN
   ‚îú‚îÄ Clicar em "Registrar Entrada"
   ‚îú‚îÄ Selecionar unidade
   ‚îî‚îÄ Confirmar
       ‚îî‚îÄ Sistema registra: data/hora, IP, geolocaliza√ß√£o

3. CRIAR ORDEM DE SERVI√áO
   ‚îú‚îÄ Menu: "Nova Manuten√ß√£o"
   ‚îú‚îÄ Preencher formul√°rio:
   ‚îÇ   ‚îú‚îÄ Selecionar equipamento (autocomplete)
   ‚îÇ   ‚îú‚îÄ Tipo: Preventiva/Corretiva/Preditiva
   ‚îÇ   ‚îú‚îÄ Prioridade: Baixa/M√©dia/Alta/Urgente
   ‚îÇ   ‚îú‚îÄ Descri√ß√£o do problema
   ‚îÇ   ‚îî‚îÄ Upload de fotos (drag & drop)
   ‚îú‚îÄ Clicar "Salvar"
   ‚îî‚îÄ Sistema gera n√∫mero: OS-2024-0001

4. USAR PE√áAS DO ESTOQUE
   ‚îú‚îÄ Na tela da OS, se√ß√£o "Materiais Utilizados"
   ‚îú‚îÄ Buscar pe√ßa (autocomplete)
   ‚îú‚îÄ Informar quantidade (aceita decimal: 3.5)
   ‚îî‚îÄ Clicar "Adicionar"
       ‚îú‚îÄ Sistema valida estoque dispon√≠vel
       ‚îú‚îÄ ‚úì Suficiente ‚Üí Desconta e registra movimenta√ß√£o
       ‚îî‚îÄ ‚úó Insuficiente ‚Üí Alerta: "Estoque atual: 2.0m"

5. FINALIZAR OS
   ‚îú‚îÄ Preencher "Solu√ß√£o Aplicada"
   ‚îú‚îÄ Upload de fotos "depois"
   ‚îú‚îÄ Informar tempo de execu√ß√£o
   ‚îú‚îÄ Alterar status para "Conclu√≠da"
   ‚îî‚îÄ Clicar "Finalizar"

6. CRIAR CHAMADO EXTERNO
   ‚îú‚îÄ Situa√ß√£o: Problema al√©m da capacidade t√©cnica
   ‚îú‚îÄ Menu: "Solicitar Terceirizado"
   ‚îú‚îÄ Selecionar prestador (filtrar por especialidade)
   ‚îú‚îÄ Preencher:
   ‚îÇ   ‚îú‚îÄ T√≠tulo e descri√ß√£o
   ‚îÇ   ‚îú‚îÄ Prazo combinado
   ‚îÇ   ‚îî‚îÄ Vincular √† OS (opcional)
   ‚îî‚îÄ Clicar "Solicitar"
       ‚îî‚îÄ Sistema envia WhatsApp automaticamente

7. CHECK-OUT
   ‚îú‚îÄ Clicar em "Registrar Sa√≠da"
   ‚îî‚îÄ Sistema calcula horas trabalhadas
```

### 4.2 Fluxo do Gerente

```
1. ACESSAR DASHBOARD
   ‚îú‚îÄ Login (sem restri√ß√£o de IP)
   ‚îî‚îÄ Visualizar:
       ‚îú‚îÄ M√©tricas gerais (cards)
       ‚îú‚îÄ Chamados externos (tabela com sem√°foro)
       ‚îú‚îÄ Estoque cr√≠tico (alertas)
       ‚îî‚îÄ Pedidos de compra (status de entrega)

2. MONITORAR TERCEIRIZADOS
   ‚îú‚îÄ Identificar chamado atrasado (linha vermelha)
   ‚îú‚îÄ Clicar bot√£o "Cobrar"
   ‚îî‚îÄ Sistema reenvia WhatsApp:
       "‚è∞ Prazo vencido. Qual a previs√£o de conclus√£o?"

3. APROVAR PEDIDO DE COMPRA
   ‚îú‚îÄ T√©cnico solicita compra de pe√ßas
   ‚îú‚îÄ Gerente recebe notifica√ß√£o
   ‚îú‚îÄ Acessar "Pedidos Pendentes"
   ‚îú‚îÄ Revisar itens e valores
   ‚îî‚îÄ Clicar "Aprovar" ou "Rejeitar"
       ‚îî‚îÄ Se aprovado: Atualizar status para "Em Tr√¢nsito"

4. ANALISAR INDICADORES
   ‚îú‚îÄ Menu: "Relat√≥rios"
   ‚îú‚îÄ Aplicar filtros:
   ‚îÇ   ‚îú‚îÄ Per√≠odo (data in√≠cio/fim)
   ‚îÇ   ‚îú‚îÄ Unidade
   ‚îÇ   ‚îî‚îÄ Tipo de manuten√ß√£o
   ‚îú‚îÄ Visualizar gr√°ficos:
   ‚îÇ   ‚îú‚îÄ Evolu√ß√£o de OS
   ‚îÇ   ‚îú‚îÄ Taxa de conclus√£o
   ‚îÇ   ‚îî‚îÄ Custos por unidade
   ‚îî‚îÄ Exportar para CSV

5. AVALIAR SERVI√áO DE TERCEIRIZADO
   ‚îú‚îÄ Chamado conclu√≠do
   ‚îú‚îÄ Acessar detalhes do chamado
   ‚îú‚îÄ Avaliar (1 a 5 estrelas)
   ‚îú‚îÄ Escrever feedback (opcional)
   ‚îî‚îÄ Clicar "Enviar Avalia√ß√£o"
       ‚îî‚îÄ Sistema atualiza m√©dia do prestador

6. GERENCIAR ESTOQUE
   ‚îú‚îÄ Receber alerta: "3 itens abaixo do estoque m√≠nimo"
   ‚îú‚îÄ Menu: "Estoque"
   ‚îú‚îÄ Visualizar itens cr√≠ticos (destacados)
   ‚îú‚îÄ Clicar "Solicitar Compra"
   ‚îî‚îÄ Sistema cria pedido automaticamente
```

---

## 5. Requisitos N√£o-Funcionais

### 5.1 Performance

| Requisito | Meta | Cr√≠tico |
|-----------|------|---------|
| Tempo de carregamento do dashboard | < 2s | Sim |
| Tempo de resposta de APIs | < 500ms | Sim |
| Upload de foto (5MB) | < 3s | N√£o |
| Gera√ß√£o de relat√≥rio CSV (1000 linhas) | < 5s | N√£o |
| Consultas de banco de dados | < 200ms | Sim |

**Estrat√©gias:**
- √çndices em colunas de busca frequente (usuario_id, unidade_id, status)
- Cache de indicadores (Redis) com TTL de 1 hora
- Lazy loading de imagens no frontend
- Pagination em listagens (50 registros por p√°gina)
- Compress√£o Gzip no Nginx

### 5.2 Seguran√ßa

**Autentica√ß√£o e Autoriza√ß√£o:**
- Sess√µes com timeout de 2 horas de inatividade
- HTTPS obrigat√≥rio em produ√ß√£o (certificado SSL)
- Prote√ß√£o CSRF em todos os formul√°rios
- Rate limiting: 100 requests/minuto por IP
- Sanitiza√ß√£o de inputs (preven√ß√£o XSS/SQL Injection)

**Controle de Acesso (RBAC):**
```
T√©cnico:
  ‚úì Criar/editar pr√≥prias OS
  ‚úì Usar pe√ßas do estoque
  ‚úì Criar chamados externos
  ‚úì Check-in/out
  ‚úó Aprovar pedidos
  ‚úó Ver indicadores globais
  ‚úó Gerenciar usu√°rios

Gerente:
  ‚úì Todas permiss√µes de T√©cnico
  ‚úì Aprovar pedidos de compra
  ‚úì Ver dashboard completo
  ‚úì Avaliar terceirizados
  ‚úì Exportar relat√≥rios
  ‚úó Gerenciar usu√°rios/unidades

Admin:
  ‚úì Todas permiss√µes
  ‚úì Criar/editar usu√°rios
  ‚úì Configurar unidades
  ‚úì Acessar logs de auditoria
```

**Dados Sens√≠veis:**
- Senhas: Hash bcrypt (cost 12)
- API Keys: Armazenadas em vari√°veis de ambiente (n√£o no c√≥digo)
- Logs: N√£o registrar senhas ou tokens
- Backup: Criptografia AES-256

### 5.3 Usabilidade

**Responsividade:**
- Breakpoints: 
  - Mobile: < 768px (menu hamb√∫rguer, cards empilhados)
  - Tablet: 768px - 1024px (2 colunas)
  - Desktop: > 1024px (layout completo)
- Formul√°rios otimizados para mobile (inputs grandes, scroll suave)
- Tabelas horizontalmente scrollable em mobile

**Acessibilidade (WCAG 2.1 - N√≠vel AA):**
- Contraste m√≠nimo 4.5:1 para texto
- Labels em todos os campos de formul√°rio
- Navega√ß√£o por teclado (tab order l√≥gico)
- Mensagens de erro descritivas
- Alt text em imagens

**Feedback Visual:**
- Loading spinners em opera√ß√µes ass√≠ncronas
- Toast notifications para a√ß√µes (sucesso/erro)
- Confirma√ß√£o modal para a√ß√µes destrutivas (cancelar OS)
- Indicadores de progresso em uploads

### 5.4 Confiabilidade

**Disponibilidade:**
- SLA: 99% uptime (< 7.2h downtime/m√™s)
- Backup di√°rio autom√°tico (3h da manh√£)
- Reten√ß√£o: 30 dias no banco, 90 dias em storage externo

**Tratamento de Erros:**
```python
# Padr√£o para todas as rotas
try:
    # L√≥gica de neg√≥cio
    return jsonify({'success': True, 'data': result}), 200
except ValidationError as e:
    return jsonify({'success': False, 'error': str(e)}), 400
except DatabaseError as e:
    log_error(e)
    return jsonify({'success': False, 'error': 'Erro ao processar solicita√ß√£o'}), 500
except Exception as e:
    log_critical(e)
    return jsonify({'success': False, 'error': 'Erro inesperado'}), 500
```

**Logs e Monitoramento:**
- Logs estruturados (JSON) com n√≠veis: DEBUG, INFO, WARNING, ERROR, CRITICAL
- Rota√ß√£o di√°ria de arquivos de log (manter 30 dias)
- Integra√ß√£o com Sentry para rastreamento de exce√ß√µes
- Healthcheck endpoint: `/api/health` (status do DB, Redis, APIs externas)

### 5.5 Manutenibilidade

**C√≥digo:**
- PEP 8 (Python) e ESLint (JavaScript)
- Cobertura de testes: m√≠nimo 70%
- Documenta√ß√£o inline (docstrings)
- Versionamento sem√¢ntico (major.minor.patch)

**Estrutura de Pastas:**
```
gmm_system/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ usuario.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ordem_servico.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ   ‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ manutencao.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ estoque_service.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ notificacao_service.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ   ‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ validators.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ decorators.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ   ‚îú‚îÄ‚îÄ static/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ css/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ js/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ uploads/
‚îÇ   ‚îî‚îÄ‚îÄ templates/
‚îÇ       ‚îú‚îÄ‚îÄ base.html
‚îÇ       ‚îú‚îÄ‚îÄ auth/
‚îÇ       ‚îú‚îÄ‚îÄ dashboard/
‚îÇ       ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îú‚îÄ‚îÄ unit/
‚îÇ   ‚îú‚îÄ‚îÄ integration/
‚îÇ   ‚îî‚îÄ‚îÄ e2e/
‚îú‚îÄ‚îÄ migrations/
‚îú‚îÄ‚îÄ config.py
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ docker-compose.yml
‚îî‚îÄ‚îÄ README.md
```

---

## 6. Plano de Implementa√ß√£o

### 6.1 Fases do Projeto

**Fase 1 - MVP (4 semanas):**
- Semana 1: M√≥dulo 1 (Auth + Controle de Ponto)
- Semana 2: M√≥dulo 2 (OS + Estoque b√°sico)
- Semana 3: M√≥dulo 3 (Terceirizados + WhatsApp)
- Semana 4: M√≥dulo 4 (Dashboard b√°sico)
- Entrega: Sistema funcional para 1 unidade piloto

**Fase 2 - Melhorias (3 semanas):**
- Semana 5: Testes e corre√ß√µes de bugs
- Semana 6: Indicadores avan√ßados + Relat√≥rios
- Semana 7: Notifica√ß√µes por email + Melhorias UX
- Entrega: Rollout para as 4 unidades

**Fase 3 - Otimiza√ß√£o (2 semanas):**
- Semana 8: Migra√ß√£o SQLite ‚Üí PostgreSQL
- Semana 9: Otimiza√ß√£o de performance + Deploy produ√ß√£o

### 6.2 Sprints Detalhadas

**Sprint 1 (M√≥dulo 1):**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Dia 1-2: Setup do projeto                       ‚îÇ
‚îÇ  ‚Ä¢ Estrutura de pastas                          ‚îÇ
‚îÇ  ‚Ä¢ Configura√ß√£o Flask + SQLAlchemy              ‚îÇ
‚îÇ  ‚Ä¢ Docker Compose (Flask + SQLite)              ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ Dia 3-4: Modelos e Auth                        ‚îÇ
‚îÇ  ‚Ä¢ Criar tabelas (usuarios, unidades, ponto)   ‚îÇ
‚îÇ  ‚Ä¢ Implementar Flask-Login                      ‚îÇ
‚îÇ  ‚Ä¢ Hash de senhas (bcrypt)                      ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ Dia 5-6: Controle de IP                        ‚îÇ
‚îÇ  ‚Ä¢ Decorator @require_unit_ip                   ‚îÇ
‚îÇ  ‚Ä¢ Rotas check-in/checkout                      ‚îÇ
‚îÇ  ‚Ä¢ Valida√ß√£o de faixa de IP                     ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ Dia 7: Templates e Testes                      ‚îÇ
‚îÇ  ‚Ä¢ HTML: login.html, dashboard.html             ‚îÇ
‚îÇ  ‚Ä¢ Testes unit√°rios (pytest)                    ‚îÇ
‚îÇ  ‚Ä¢ Documenta√ß√£o do m√≥dulo                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

Crit√©rios de conclus√£o:
‚òë T√©cnico consegue fazer login apenas do Wi-Fi
‚òë Check-in registra corretamente
‚òë Todos os testes passam (100% coverage do m√≥dulo)
```

**Sprint 2 (M√≥dulo 2):**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Dia 1-2: Modelos de OS e Estoque               ‚îÇ
‚îÇ  ‚Ä¢ Criar tabelas                                ‚îÇ
‚îÇ  ‚Ä¢ Relationships (FK)                           ‚îÇ
‚îÇ  ‚Ä¢ Seeds para teste                             ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ Dia 3-4: CRUD de OS                            ‚îÇ
‚îÇ  ‚Ä¢ Rotas criar/editar/listar OS                 ‚îÇ
‚îÇ  ‚Ä¢ Gera√ß√£o autom√°tica de n√∫mero                 ‚îÇ
‚îÇ  ‚Ä¢ Valida√ß√µes de formul√°rio                     ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ Dia 5: Upload e Estoque                        ‚îÇ
‚îÇ  ‚Ä¢ Implementar upload m√∫ltiplo                  ‚îÇ
‚îÇ  ‚Ä¢ Gerar thumbnails (Pillow)                    ‚îÇ
‚îÇ  ‚Ä¢ L√≥gica de desconto de estoque                ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ Dia 6-7: Frontend e Testes                     ‚îÇ
‚îÇ  ‚Ä¢ Templates (nova_os.html, detalhes_os.html)   ‚îÇ
‚îÇ  ‚Ä¢ Dropzone.js para upload                      ‚îÇ
‚îÇ  ‚Ä¢ Testes de integra√ß√£o                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

Crit√©rios de conclus√£o:
‚òë T√©cnico cria OS com fotos
‚òë Sistema impede uso de pe√ßa sem estoque
‚òë Movimenta√ß√µes s√£o registradas corretamente
```

**Sprint 3 (M√≥dulo 3):**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Dia 1-2: Setup Celery e MegaAPI                ‚îÇ
‚îÇ  ‚Ä¢ Configurar Redis + Celery                    ‚îÇ
‚îÇ  ‚Ä¢ Fun√ß√£o enviar_whatsapp()                     ‚îÇ
‚îÇ  ‚Ä¢ Testes com mock da API                       ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ Dia 3-4: Gest√£o de Chamados                    ‚îÇ
‚îÇ  ‚Ä¢ CRUD de chamados externos                    ‚îÇ
‚îÇ  ‚Ä¢ Trigger autom√°tico de notifica√ß√£o           ‚îÇ
‚îÇ  ‚Ä¢ Hist√≥rico de mensagens                       ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ Dia 5: Sistema de Lembretes                    ‚îÇ
‚îÇ  ‚Ä¢ Celery Beat (tarefas agendadas)             ‚îÇ
‚îÇ  ‚Ä¢ Verifica√ß√£o de prazos                        ‚îÇ
‚îÇ  ‚Ä¢ Retry policy para falhas                     ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ Dia 6-7: Frontend e Integra√ß√£o                 ‚îÇ
‚îÇ  ‚Ä¢ Templates de chamados                        ‚îÇ
‚îÇ  ‚Ä¢ Bot√£o "Cobrar"                               ‚îÇ
‚îÇ  ‚Ä¢ Testes end-to-end                            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

Crit√©rios de conclus√£o:
‚òë WhatsApp √© enviado ao criar chamado
‚òë Lembretes autom√°ticos funcionam
‚òë Retry em caso de falha da API
```

**Sprint 4 (M√≥dulo 4):**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Dia 1-2: Queries e Indicadores                 ‚îÇ
‚îÇ  ‚Ä¢ Implementar c√°lculos de KPIs                 ‚îÇ
‚îÇ  ‚Ä¢ Task Celery para atualiza√ß√£o di√°ria          ‚îÇ
‚îÇ  ‚Ä¢ Tabela de cache (indicadores_performance)    ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ Dia 3-4: Dashboard                              ‚îÇ
‚îÇ  ‚Ä¢ Layout responsivo (Bootstrap)                ‚îÇ
‚îÇ  ‚Ä¢ Cards de m√©tricas                            ‚îÇ
‚îÇ  ‚Ä¢ Tabelas com sem√°foro                         ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ Dia 5: Gr√°ficos e Relat√≥rios                   ‚îÇ
‚îÇ  ‚Ä¢ Integra√ß√£o Chart.js                          ‚îÇ
‚îÇ  ‚Ä¢ Endpoints para dados dos gr√°ficos            ‚îÇ
‚îÇ  ‚Ä¢ Exporta√ß√£o CSV                               ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ Dia 6-7: Alertas e Polimento                   ‚îÇ
‚îÇ  ‚Ä¢ Sistema de notifica√ß√µes                      ‚îÇ
‚îÇ  ‚Ä¢ Testes de performance                        ‚îÇ
‚îÇ  ‚Ä¢ Ajustes finais de UX                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

Crit√©rios de conclus√£o:
‚òë Dashboard carrega em < 2s
‚òë Sem√°foro exibe status corretos
‚òë Gr√°ficos s√£o interativos
‚òë Exporta√ß√£o funciona para 1000+ linhas
```

### 6.3 Depend√™ncias e Riscos

**Depend√™ncias Externas:**
| Item | Fornecedor | Impacto | Conting√™ncia |
|------|-----------|---------|--------------|
| API WhatsApp | MegaAPI | Alto | Implementar fila offline, reenviar quando dispon√≠vel |
| Certificado SSL | Let's Encrypt | M√©dio | Usar certificado autoassinado temporariamente |
| Email SMTP | Gmail/AWS SES | Baixo | Logs locais como fallback |

**Riscos Identificados:**
1. **Lat√™ncia da rede nas unidades** (Prob: Alta, Impacto: M√©dio)
   - Mitiga√ß√£o: Implementar cache local, sincroniza√ß√£o offline
   
2. **Resist√™ncia √† ado√ß√£o pelos t√©cnicos** (Prob: M√©dia, Impacto: Alto)
   - Mitiga√ß√£o: Treinamento hands-on, gamifica√ß√£o (badges), suporte dedicado
   
3. **Falhas na API de WhatsApp** (Prob: M√©dia, Impacto: M√©dio)
   - Mitiga√ß√£o: Sistema de retry, m√∫ltiplos canais (email backup)
   
4. **Estouro de prazo** (Prob: M√©dia, Impacto: M√©dio)
   - Mitiga√ß√£o: Buffer de 20% no cronograma, prioriza√ß√£o de MVP

---

## 7. Testes e Qualidade

### 7.1 Estrat√©gia de Testes

**Pir√¢mide de Testes:**
```
        ‚ï±‚ï≤
       ‚ï±E2E‚ï≤          10% - Testes End-to-End
      ‚ï±‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ï≤
     ‚ï±  Integ ‚ï≤       30% - Testes de Integra√ß√£o
    ‚ï±‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ï≤
   ‚ï±  Unit√°rios ‚ï≤     60% - Testes Unit√°rios
  ‚ï±‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ï≤
```

**Testes Unit√°rios (pytest):**
```python
# Exemplo: tests/unit/test_estoque_service.py

def test_descontar_estoque_sucesso():
    """Deve descontar estoque quando quantidade suficiente"""
    peca = Estoque(nome="Cabo", quantidade=10.0)
    resultado = EstoqueService.descontar(peca, 3.5)
    
    assert resultado.success == True
    assert peca.quantidade == 6.5

def test_descontar_estoque_insuficiente():
    """Deve falhar quando estoque insuficiente"""
    peca = Estoque(nome="Cabo", quantidade=2.0)
    resultado = EstoqueService.descontar(peca, 3.5)
    
    assert resultado.success == False
    assert "insuficiente" in resultado.error.lower()
```

**Testes de Integra√ß√£o:**
```python
# tests/integration/test_criar_os_com_pecas.py

def test_criar_os_e_consumir_pecas(client, auth):
    """Deve criar OS e descontar pe√ßas do estoque"""
    auth.login(tipo='tecnico')
    
    # Arrange
    peca = criar_peca_teste(quantidade=10.0)
    
    # Act
    response = client.post('/api/os/criar', json={
        'titulo': 'Manuten√ß√£o teste',
        'pecas': [{'id': peca.id, 'quantidade': 3.0}]
    })
    
    # Assert
    assert response.status_code == 201
    assert Estoque.query.get(peca.id).quantidade == 7.0
    assert MovimentacaoEstoque.query.count() == 1
```

**Testes E2E (Selenium):**
```python
# tests/e2e/test_fluxo_completo_manutencao.py

def test_fluxo_completo_tecnico(browser):
    """Simula fluxo completo: login ‚Üí criar OS ‚Üí usar pe√ßa ‚Üí finalizar"""
    
    # Login
    browser.get('http://localhost:5000/login')
    browser.find_element(By.ID, 'login').send_keys('tecnico1')
    browser.find_element(By.ID, 'senha').send_keys('senha123')
    browser.find_element(By.ID, 'btn-login').click()
    
    # Criar OS
    browser.find_element(By.LINK_TEXT, 'Nova Manuten√ß√£o').click()
    browser.find_element(By.ID, 'titulo').send_keys('Esteira parada')
    # ... preencher formul√°rio
    browser.find_element(By.ID, 'btn-salvar').click()
    
    # Verificar sucesso
    assert 'OS criada com sucesso' in browser.page_source
```

### 7.2 Checklist de Qualidade

**Antes do Deploy:**
- [ ] Todos os testes unit√°rios passando (100%)
- [ ] Cobertura de c√≥digo > 70%
- [ ] Testes de integra√ß√£o passando
- [ ] Pelo menos 1 teste E2E por m√≥dulo
- [ ] Sem vulnerabilidades cr√≠ticas (Bandit/Safety)
- [ ] Linter sem erros (Flake8/Black)
- [ ] Documenta√ß√£o atualizada (README + docstrings)
- [ ] Secrets n√£o commitados (.env no .gitignore)
- [ ] Migrations testadas (up e down)
- [ ] Performance auditada (rotas < 500ms)

---

## 8. Deployment e DevOps

### 8.1 Ambiente de Desenvolvimento

```yaml
# docker-compose.yml

version: '3.8'

services:
  web:
    build: .
    ports:
      - "5000:5000"
    volumes:
      - .:/app
      - uploads:/app/static/uploads
    environment:
      - FLASK_ENV=development
      - DATABASE_URL=sqlite:///gmm.db
      - REDIS_URL=redis://redis:6379/0
    depends_on:
      - redis

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"

  celery_worker:
    build: .
    command: celery -A app.celery_app worker --loglevel=info
    volumes:
      - .:/app
    environment:
      - REDIS_URL=redis://redis:6379/0
    depends_on:
      - redis

  celery_beat:
    build: .
    command: celery -A app.celery_app beat --loglevel=info
    volumes:
      - .:/app
    environment:
      - REDIS_URL=redis://redis:6379/0
    depends_on:
      - redis

volumes:
  uploads:
```

**Comandos √öteis:**
```bash
# Iniciar ambiente completo
docker-compose up -d

# Ver logs em tempo real
docker-compose logs -f web

# Executar migrations
docker-compose exec web flask db upgrade

# Acessar shell do Flask
docker-compose exec web flask shell

# Rodar testes
docker-compose exec web pytest tests/ -v --cov

# Parar tudo
docker-compose down
```

### 8.2 Ambiente de Produ√ß√£o

**Infraestrutura AWS:**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                 Load Balancer                    ‚îÇ
‚îÇ              (Application LB)                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ                     ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îê          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îê
‚îÇ EC2-01 ‚îÇ          ‚îÇ EC2-02 ‚îÇ  (Auto Scaling)
‚îÇ Nginx  ‚îÇ          ‚îÇ Nginx  ‚îÇ
‚îÇ Flask  ‚îÇ          ‚îÇ Flask  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îò
    ‚îÇ                    ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ   RDS PostgreSQL ‚îÇ
    ‚îÇ   (Multi-AZ)     ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ ElastiCache Redis‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ     S3 Bucket    ‚îÇ
    ‚îÇ  (Uploads/Backups)‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Stack de Produ√ß√£o:**
- **Web Server:** Nginx (reverse proxy + servir est√°ticos)
- **WSGI:** Gunicorn (4 workers por CPU core)
- **Database:** RDS PostgreSQL 15 (db.t3.medium)
- **Cache:** ElastiCache Redis (cache.t3.micro)
- **Storage:** S3 para uploads e backups
- **CDN:** CloudFront para assets est√°ticos
- **SSL:** ACM (AWS Certificate Manager)
- **Monitoramento:** CloudWatch + Sentry

**Configura√ß√£o Nginx:**
```nginx
# /etc/nginx/sites-available/gmm

upstream flask_app {
    least_conn;
    server 127.0.0.1:8000;
    server 127.0.0.1:8001;
    server 127.0.0.1:8002;
    server 127.0.0.1:8003;
}

server {
    listen 80;
    server_name gmm.academia.com;
    
    # Redirect HTTP to HTTPS
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name gmm.academia.com;
    
    ssl_certificate /etc/letsencrypt/live/gmm.academia.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/gmm.academia.com/privkey.pem;
    
    client_max_body_size 10M;
    
    # Security headers
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
    
    # Static files
    location /static/ {
        alias /var/www/gmm/static/;
        expires 30d;
        add_header Cache-Control "public, immutable";
    }
    
    # Uploads (S3 em produ√ß√£o)
    location /uploads/ {
        alias /var/www/gmm/uploads/;
        expires 7d;
    }
    
    # Flask app
    location / {
        proxy_pass http://flask_app;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # Timeouts
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }
    
    # Healthcheck
    location /health {
        access_log off;
        return 200 "OK";
    }
}
```

**Configura√ß√£o Gunicorn:**
```python
# gunicorn_config.py

import multiprocessing

bind = "0.0.0.0:8000"
workers = multiprocessing.cpu_count() * 2 + 1  # 4 cores = 9 workers
worker_class = "sync"
worker_connections = 1000
timeout = 60
keepalive = 5

# Logging
accesslog = "/var/log/gmm/gunicorn-access.log"
errorlog = "/var/log/gmm/gunicorn-error.log"
loglevel = "info"

# Security
limit_request_line = 4096
limit_request_fields = 100

# Preload app para economizar mem√≥ria
preload_app = True
```

### 8.3 CI/CD Pipeline

**GitHub Actions Workflow:**
```yaml
# .github/workflows/deploy.yml

name: Deploy GMM System

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest
    
    services:
      redis:
        image: redis:7-alpine
        ports:
          - 6379:6379
    
    steps:
      - uses: actions/checkout@v3
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: |
          pip install -r requirements.txt
          pip install pytest pytest-cov
      
      - name: Run linter
        run: |
          pip install flake8 black
          flake8 app/ --max-line-length=100
          black --check app/
      
      - name: Run security scan
        run: |
          pip install bandit safety
          bandit -r app/ -ll
          safety check
      
      - name: Run tests
        env:
          FLASK_ENV: testing
          DATABASE_URL: sqlite:///:memory:
          REDIS_URL: redis://localhost:6379/0
        run: |
          pytest tests/ -v --cov=app --cov-report=xml
      
      - name: Upload coverage
        uses: codecov/codecov-action@v3
        with:
          file: ./coverage.xml

  deploy:
    needs: test
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    
    steps:
      - uses: actions/checkout@v3
      
      - name: Configure AWS credentials
        uses: aws-actions/configure-aws-credentials@v2
        with:
          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          aws-region: us-east-1
      
      - name: Deploy to EC2
        run: |
          # SSH into EC2 and pull latest code
          ssh -i ${{ secrets.SSH_KEY }} ubuntu@ec2-instance << 'EOF'
            cd /var/www/gmm
            git pull origin main
            source venv/bin/activate
            pip install -r requirements.txt
            flask db upgrade
            sudo systemctl restart gmm
            sudo systemctl restart celery
          EOF
      
      - name: Run smoke tests
        run: |
          # Verificar se a aplica√ß√£o est√° respondendo
          curl -f https://gmm.academia.com/health || exit 1
      
      - name: Notify team
        if: always()
        uses: 8398a7/action-slack@v3
        with:
          status: ${{ job.status }}
          webhook_url: ${{ secrets.SLACK_WEBHOOK }}
```

### 8.4 Backup e Recupera√ß√£o

**Estrat√©gia de Backup:**
```bash
#!/bin/bash
# backup.sh - Executado diariamente √†s 3h via cron

BACKUP_DIR="/var/backups/gmm"
DATE=$(date +%Y%m%d_%H%M%S)
S3_BUCKET="s3://gmm-backups"

# 1. Backup do Banco de Dados
pg_dump -h rds-endpoint.amazonaws.com \
        -U gmm_user \
        -d gmm_production \
        -F c \
        -f "$BACKUP_DIR/db_$DATE.dump"

# 2. Backup de Uploads (se n√£o estiver no S3)
tar -czf "$BACKUP_DIR/uploads_$DATE.tar.gz" /var/www/gmm/uploads/

# 3. Enviar para S3
aws s3 cp "$BACKUP_DIR/db_$DATE.dump" "$S3_BUCKET/db/"
aws s3 cp "$BACKUP_DIR/uploads_$DATE.tar.gz" "$S3_BUCKET/uploads/"

# 4. Limpar backups locais > 7 dias
find $BACKUP_DIR -type f -mtime +7 -delete

# 5. Verificar integridade
pg_restore --list "$BACKUP_DIR/db_$DATE.dump" > /dev/null
if [ $? -eq 0 ]; then
    echo "‚úì Backup bem-sucedido: $DATE"
else
    echo "‚úó Falha no backup: $DATE"
    # Enviar alerta
    curl -X POST $SLACK_WEBHOOK -d '{"text":"‚ö†Ô∏è Falha no backup GMM"}'
fi
```

**Plano de Recupera√ß√£o de Desastres (DR):**
```
RTO (Recovery Time Objective): 2 horas
RPO (Recovery Point Objective): 24 horas (√∫ltimo backup di√°rio)

PROCEDIMENTO DE RECUPERA√á√ÉO:

1. Provisionar nova inst√¢ncia EC2 (10 min)
   - AMI pr√©-configurada com software
   - Security groups e IAM roles

2. Restaurar banco de dados (30 min)
   $ aws s3 cp s3://gmm-backups/db/db_latest.dump .
   $ pg_restore -h new-rds.amazonaws.com -d gmm_production db_latest.dump

3. Restaurar uploads (20 min)
   $ aws s3 sync s3://gmm-backups/uploads/ /var/www/gmm/uploads/

4. Deploy da aplica√ß√£o (15 min)
   $ git clone https://github.com/academia/gmm-system
   $ pip install -r requirements.txt
   $ gunicorn -c gunicorn_config.py app:app

5. Atualizar DNS (5 min)
   - Apontar gmm.academia.com para novo IP

6. Valida√ß√£o (20 min)
   - Executar smoke tests
   - Verificar logs
   - Testar funcionalidades cr√≠ticas

TEMPO TOTAL ESTIMADO: 1h 40min
```

---

## 9. Treinamento e Documenta√ß√£o

### 9.1 Materiais de Treinamento

**Para T√©cnicos (2 horas):**
1. **Introdu√ß√£o (15 min)**
   - Objetivos do sistema
   - Tour pela interface
   - Demonstra√ß√£o de caso de uso completo

2. **Hands-on: Dia a Dia (60 min)**
   - Pr√°tica: Fazer check-in
   - Pr√°tica: Criar OS com fotos
   - Pr√°tica: Usar pe√ßas do estoque
   - Pr√°tica: Solicitar terceirizado
   - Pr√°tica: Finalizar OS

3. **Casos Especiais (30 min)**
   - O que fazer se estoque insuficiente?
   - Como reportar bug/problema?
   - Onde encontrar ajuda?

4. **Q&A e Certifica√ß√£o (15 min)**
   - Quiz de 10 perguntas
   - Certificado de conclus√£o

**Para Gerentes (1.5 horas):**
1. **Vis√£o Estrat√©gica (20 min)**
   - KPIs e como interpret√°-los
   - Identificar gargalos
   - Tomar decis√µes baseadas em dados

2. **Monitoramento e Controle (40 min)**
   - Usar o dashboard
   - Gerenciar terceirizados
   - Aprovar pedidos de compra
   - Gerar relat√≥rios

3. **Administra√ß√£o (30 min)**
   - Cadastrar usu√°rios
   - Configurar alertas
   - Exportar dados

### 9.2 Documenta√ß√£o T√©cnica

**README.md (GitHub):**
```markdown
# Sistema GMM - Gest√£o de Manuten√ß√£o de Academias

## Quick Start

### Pr√©-requisitos
- Python 3.11+
- Docker & Docker Compose
- Git

### Instala√ß√£o (Desenvolvimento)

1. Clone o reposit√≥rio
git clone https://github.com/academia/gmm-system
cd gmm-system

2. Crie ambiente virtual
python -m venv venv
source venv/bin/activate  # Linux/Mac
venv\Scripts\activate     # Windows

3. Instale depend√™ncias
pip install -r requirements.txt

4. Configure vari√°veis de ambiente
cp .env.example .env
# Edite .env com suas configura√ß√µes

5. Inicialize o banco de dados
flask db upgrade
python seed.py  # Dados de teste

6. Execute a aplica√ß√£o
flask run

Acesse: http://localhost:5000
Login padr√£o: admin / admin123

## Estrutura do Projeto

app/
‚îú‚îÄ‚îÄ models/          # Modelos SQLAlchemy
‚îú‚îÄ‚îÄ routes/          # Blueprints (rotas)
‚îú‚îÄ‚îÄ services/        # L√≥gica de neg√≥cio
‚îú‚îÄ‚îÄ templates/       # Templates HTML
‚îú‚îÄ‚îÄ static/          # CSS, JS, imagens
‚îî‚îÄ‚îÄ utils/           # Fun√ß√µes auxiliares

## Comandos √öteis

# Criar migration
flask db migrate -m "descri√ß√£o"

# Aplicar migrations
flask db upgrade

# Rollback migration
flask db downgrade

# Shell interativo
flask shell

# Rodar testes
pytest tests/ -v

# Ver cobertura
pytest --cov=app --cov-report=html

## Deploy

Ver documenta√ß√£o completa em: docs/DEPLOY.md

## Contribuindo

1. Fork o projeto
2. Crie uma branch (git checkout -b feature/nova-funcionalidade)
3. Commit suas mudan√ßas (git commit -m 'Add: nova funcionalidade')
4. Push para a branch (git push origin feature/nova-funcionalidade)
5. Abra um Pull Request

## Suporte

- üìß Email: suporte@academia.com
- üí¨ Slack: #gmm-sistema
- üìö Docs: https://docs.gmm.academia.com

## Licen√ßa

Propriedade de Academia XYZ - Uso interno apenas
```

**Manual do Usu√°rio (PDF):**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ       MANUAL DO USU√ÅRIO - SISTEMA GMM       ‚îÇ
‚îÇ            Vers√£o 1.0 - 2024               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

SUM√ÅRIO
1. Introdu√ß√£o...............................3
2. Acesso ao Sistema........................5
3. Para T√©cnicos...........................8
   3.1 Controle de Ponto...................8
   3.2 Ordens de Servi√ßo..................10
   3.3 Gest√£o de Estoque..................15
   3.4 Terceirizados......................18
4. Para Gerentes..........................22
   4.1 Dashboard..........................22
   4.2 Relat√≥rios.........................28
   4.3 Aprova√ß√µes.........................32
5. Troubleshooting........................35
6. Gloss√°rio..............................40
7. FAQ....................................42

CAP√çTULO 3.2 - ORDENS DE SERVI√áO

3.2.1 CRIANDO UMA NOVA OS

Passo 1: Clique em "Nova Manuten√ß√£o" no menu
[SCREENSHOT]

Passo 2: Preencha os campos obrigat√≥rios (*)
- Equipamento*: Selecione da lista ou digite para buscar
- Tipo*: Preventiva, Corretiva ou Preditiva
- Prioridade*: Baixa, M√©dia, Alta ou Urgente
- Descri√ß√£o do Problema*: Seja espec√≠fico

Passo 3: Adicione fotos (opcional, mas recomendado)
- Arraste arquivos para a √°rea pontilhada
- Ou clique para selecionar do computador
- Formatos aceitos: JPG, PNG (m√°x 5MB por foto)

[SCREENSHOT COM ANOTA√á√ïES]

Passo 4: Clique em "Salvar"
‚úì Voc√™ ver√° uma mensagem de confirma√ß√£o
‚úì Um n√∫mero de OS ser√° gerado automaticamente

DICA: Tire fotos ANTES e DEPOIS da manuten√ß√£o
      para melhor documenta√ß√£o!

‚ö†Ô∏è ATEN√á√ÉO: Voc√™ s√≥ pode criar OS se estiver
            conectado ao Wi-Fi da unidade
```

### 9.3 V√≠deos Tutoriais

**Playlist no YouTube (uso interno):**
1. üìπ **Introdu√ß√£o ao Sistema GMM** (5 min)
   - Overview geral
   - Navega√ß√£o b√°sica

2. üìπ **Como fazer Check-in e Check-out** (3 min)
   - Passo a passo ilustrado

3. üìπ **Criando sua primeira OS** (8 min)
   - Preenchimento de formul√°rio
   - Upload de fotos
   - Uso de pe√ßas

4. üìπ **Gerenciando Estoque** (6 min)
   - Consultar disponibilidade
   - Entender alertas

5. üìπ **Solicitando Terceirizados** (5 min)
   - Quando solicitar
   - Como acompanhar

6. üìπ **Dashboard Gerencial** (10 min)
   - Interpreta√ß√£o de KPIs
   - A√ß√µes a tomar

---

## 10. Roadmap Futuro

### 10.1 Melhorias Planejadas (Pr√≥ximos 6 meses)

**Q1 2025:**
- [ ] App mobile nativo (React Native) para t√©cnicos
- [ ] Modo offline (sincroniza√ß√£o quando conectar)
- [ ] Leitura de QR Code nos equipamentos
- [ ] Assinatura digital na conclus√£o de OS
- [ ] Integra√ß√£o com sistema de ponto biom√©trico

**Q2 2025:**
- [ ] Intelig√™ncia Artificial:
  - Sugest√£o de pe√ßas baseada em hist√≥rico
  - Predi√ß√£o de falhas (manuten√ß√£o preditiva)
  - Detec√ß√£o de objetos em fotos (identificar pe√ßa)
- [ ] Dashboard mobile para gerentes
- [ ] Exporta√ß√£o de relat√≥rios em PDF/Excel
- [ ] API p√∫blica para integra√ß√µes

**Q3 2025:**
- [ ] Sistema de gamifica√ß√£o para t√©cnicos
  - Badges por metas atingidas
  - Ranking de performance
  - Recompensas
- [ ] Chatbot de suporte (FAQ automatizado)
- [ ] Integra√ß√£o com ERP corporativo
- [ ] Multi-idioma (Portugu√™s, Ingl√™s, Espanhol)

### 10.2 Funcionalidades em Avalia√ß√£o

**Prioridade Alta:**
- Controle de garantias de equipamentos
- Agendamento de manuten√ß√µes preventivas
- Assinatura eletr√¥nica (ICP-Brasil)

**Prioridade M√©dia:**
- Gest√£o de EPIs (Equipamentos de Prote√ß√£o)
- Controle de ve√≠culos da frota
- Portal do fornecedor (acesso externo limitado)

**Prioridade Baixa:**
- Integra√ß√£o com IoT (sensores nos equipamentos)
- Realidade Aumentada para guias de manuten√ß√£o
- Blockchain para rastreabilidade de pe√ßas

---

## 11. Gloss√°rio

| Termo | Defini√ß√£o |
|-------|-----------|
| **OS** | Ordem de Servi√ßo - Registro de uma manuten√ß√£o |
| **Check-in** | Registro de entrada do t√©cnico na unidade |
| **Check-out** | Registro de sa√≠da do t√©cnico da unidade |
| **Sem√°foro** | Sistema de cores (verde/amarelo/vermelho) para status |
| **Estoque fracionado** | Controle de pe√ßas em unidades decimais (ex: 3.5m) |
| **Terceirizado** | Prestador de servi√ßo externo contratado |
| **KPI** | Key Performance Indicator - Indicador de desempenho |
| **Dashboard** | Painel com vis√£o geral de m√©tricas |
| **MVP** | Minimum Viable Product - Vers√£o m√≠nima funcional |
| **SLA** | Service Level Agreement - Acordo de n√≠vel de servi√ßo |
| **RTO** | Recovery Time Objective - Tempo m√°ximo de recupera√ß√£o |
| **RPO** | Recovery Point Objective - Ponto m√°ximo de perda de dados |

---

## 12. Anexos

### 12.1 Fluxograma Completo do Sistema

```
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ   USU√ÅRIO    ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ    LOGIN     ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ  VALIDA IP DA UNIDADE?    ‚îÇ
                    ‚îî‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îò
                       ‚îÇ N√ÉO                 ‚îÇ SIM
            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
            ‚îÇ BLOQUEIA ACESSO ‚îÇ      ‚îÇ DASHBOARD      ‚îÇ
            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                             ‚îÇ
              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
              ‚îÇ                              ‚îÇ                     ‚îÇ
      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
      ‚îÇ  CONTROLE DE   ‚îÇ         ‚îÇ   MANUTEN√á√ÉO      ‚îÇ  ‚îÇ  TERCEIRIZADOS  ‚îÇ
      ‚îÇ     PONTO      ‚îÇ         ‚îÇ                    ‚îÇ  ‚îÇ                 ‚îÇ
      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
              ‚îÇ                              ‚îÇ                     ‚îÇ
      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
      ‚îÇ  Check-in/out  ‚îÇ         ‚îÇ   Criar OS         ‚îÇ  ‚îÇ Solicitar       ‚îÇ
      ‚îÇ  Hist√≥rico     ‚îÇ         ‚îÇ   Usar Pe√ßas       ‚îÇ  ‚îÇ WhatsApp Auto   ‚îÇ
      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îÇ   Upload Fotos     ‚îÇ  ‚îÇ Monitoramento   ‚îÇ
                                 ‚îÇ   Finalizar        ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                 ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                            ‚îÇ
                                 ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                                 ‚îÇ   ESTOQUE          ‚îÇ
                                 ‚îÇ   Valida Qtd       ‚îÇ
                                 ‚îÇ   Desconta         ‚îÇ
                                 ‚îÇ   Alerta M√≠nimo    ‚îÇ
                                 ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 12.2 Diagrama Entidade-Relacionamento (ER)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  UNIDADES   ‚îÇ       ‚îÇ   USUARIOS   ‚îÇ       ‚îÇREGISTROS_PONTO‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§       ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§       ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ id (PK)     ‚îÇ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ id (PK)      ‚îÇ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ id (PK)      ‚îÇ
‚îÇ nome        ‚îÇ   ‚îÇ   ‚îÇ nome         ‚îÇ   ‚îÇ   ‚îÇ usuario_id(FK‚îÇ
‚îÇ faixa_ip    ‚îÇ   ‚îî‚îÄ‚îÄ<‚îÇ unidade_id   ‚îÇ   ‚îî‚îÄ‚îÄ<‚îÇ unidade_id(FK‚îÇ
‚îÇ ssid_wifi   ‚îÇ       ‚îÇ tipo         ‚îÇ       ‚îÇ tipo         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îÇ senha_hash   ‚îÇ       ‚îÇ data_hora    ‚îÇ
                      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îÇ ip_origem    ‚îÇ
                             ‚îÇ               ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                             ‚îÇ
                 ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                 ‚îÇ                        ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ ORDENS_SERVICO  ‚îÇ      ‚îÇ CHAMADOS_EXTERNOS‚îÇ
        ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§      ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
        ‚îÇ id (PK)         ‚îÇ‚îÄ‚îÄ‚îê   ‚îÇ id (PK)          ‚îÇ
        ‚îÇ numero_os       ‚îÇ  ‚îÇ   ‚îÇ numero_chamado   ‚îÇ
        ‚îÇ tecnico_id (FK) ‚îÇ  ‚îÇ   ‚îÇ os_id (FK)       ‚îÇ
        ‚îÇ unidade_id (FK) ‚îÇ  ‚îÇ   ‚îÇ terceirizado_id  ‚îÇ
        ‚îÇ equipamento_id  ‚îÇ  ‚îÇ   ‚îÇ prazo_combinado  ‚îÇ
        ‚îÇ status          ‚îÇ  ‚îÇ   ‚îÇ status           ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                 ‚îÇ           ‚îÇ
     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îê        ‚îÇ
     ‚îÇ              ‚îÇ        ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇANEXOS_OS ‚îÇ  ‚îÇMOVIMENTACAO_  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§  ‚îÇ    ESTOQUE    ‚îÇ
‚îÇ id (PK)  ‚îÇ  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇos_id (FK)‚îÇ  ‚îÇ id (PK)       ‚îÇ
‚îÇtipo      ‚îÇ  ‚îÇ estoque_id(FK)‚îÇ‚îÄ‚îÄ‚îê
‚îÇcaminho   ‚îÇ  ‚îÇ os_id (FK)    ‚îÇ  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ quantidade    ‚îÇ  ‚îÇ
              ‚îÇ tipo          ‚îÇ  ‚îÇ
              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
                                 ‚îÇ
                        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                        ‚îÇ    ESTOQUE     ‚îÇ
                        ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
                        ‚îÇ id (PK)        ‚îÇ
                        ‚îÇ nome_peca      ‚îÇ
                        ‚îÇ unidade_medida ‚îÇ
                        ‚îÇ quantidade     ‚îÇ
                        ‚îÇ qtd_minima     ‚îÇ
                        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 12.3 Exemplos de Payloads da API

**POST /api/auth/login**
```json
Request:
{
  "login": "tecnico1",
  "senha": "senha123",
  "unidade_id": 1
}

Response (200):
{
  "success": true,
  "data": {
    "user": {
      "id": 5,
      "nome": "Jo√£o Silva",
      "tipo": "tecnico"
    },
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  }
}

Response (403 - IP inv√°lido):
{
  "success": false,
  "error": "Acesso negado: conecte-se ao Wi-Fi da unidade"
}
```

**POST /api/os/criar**
```json
Request:
{
  "titulo": "Esteira parada",
  "descricao_problema": "Esteira n√∫mero 5 n√£o liga. Poss√≠vel problema el√©trico.",
  "equipamento_id": 12,
  "tipo_manutencao": "corretiva",
  "prioridade": "alta",
  "unidade_id": 1
}

Response (201):
{
  "success": true,
  "data": {
    "id": 156,
    "numero_os": "OS-2024-0156",
    "status": "aberta",
    "criado_em": "2024-12-15T14:30:00Z"
  }
}
```

**POST /api/os/{id}/usar-peca**
```json
Request:
{
  "estoque_id": 8,
  "quantidade": 3.5
}

Response (200):
{
  "success": true,
  "message": "Pe√ßa descontada com sucesso",
  "data": {
    "peca": "Cabo de A√ßo 6mm",
    "quantidade_usada": 3.5,
    "estoque_restante": 12.5,
    "movimentacao_id": 89
  }
}

Response (400 - Estoque insuficiente):
{
  "success": false,
  "error": "Estoque insuficiente. Dispon√≠vel: 2.0m"
}
```

---

## 13. Considera√ß√µes Finais

### 13.1 Fatores Cr√≠ticos de Sucesso

1. **Ades√£o dos usu√°rios finais (t√©cnicos)**
   - Sistema deve ser intuitivo e n√£o adicionar carga de trabalho
   - Treinamento adequado √© essencial
   - Coletar feedback constantemente

2. **Confiabilidade do sistema**
   - Uptime de 99%+ √© crucial
   - Falhas podem impactar opera√ß√£o das unidades
   - Plano de conting√™ncia bem definido

3. **Integra√ß√£o com processos existentes**
   - N√£o criar duplicidade de trabalho
   - Migra√ß√£o gradual de processos manuais
   - Apoio da gest√£o √© fundamental

4. **Qualidade dos dados**
   - Lixo entra, lixo sai (GIGO)
   - Valida√ß√µes robustas
   - Auditoria regular

5. **Suporte cont√≠nuo**
   - Equipe de suporte dedicada
   - Documenta√ß√£o atualizada
   - Canais de comunica√ß√£o claros
